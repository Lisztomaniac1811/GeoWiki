<!DOCTYPE html>
<html lang="ka">
  <head>
    <script>
      var MetaTitle = "გვერდის მშენებელი";
      var MetaDescription = "ბეიტსის მოტელის ვიკის გვერდის მშენებელი";
      var MetaURL = "";
      var MetaImage = "";
      var WikiTitle = "ბეიტსის მოტელის ვიკი";
      var WikiLanguage = "ka"
    </script>
    <script src="js-pack.js"></script>
    <style>
      label {
      display: block;
      margin-bottom: 5px;
      }
      input {
      width: 100%;
      padding: 5px;
      margin-bottom: 10px;
      background: rgb(26, 21, 21);
      color: rgb(68, 241, 62);
      }
      button {
      padding: 10px;
      background-color: #3498db;
      color: white;
      border: none;
      cursor: pointer;
      }
      textarea {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #ccc;
      width: 100%;
      height: 600px;
      overflow: auto;
      background-color: black;
      color: #b9efff;
      font-size: 18px;
      }
      input[type="file"] {
      margin-bottom: 10px;
      }
      #preview {
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 10px;
      max-height: 600px;
      overflow: auto;
      }
      #output {
      color: orange !important;
      }
    </style>
  </head>
  <body>
    <script src="js-dropdown-nav.js"></script>
    <main>
      <script src="js-header-nav.js"></script>
      <script src="page-title.js"></script>
      <label for="fileInput">Upload HTML File:</label>
      <input type="file" id="fileInput">
      <button id="loadBtn">Load Variables</button>
      <label for="pageTitle">Page Name:</label>
      <input type="text" id="pageName" placeholder="Enter Page Name (as in file)">
      <label for="pageTitle">Page Title:</label>
      <input type="text" id="pageTitle" placeholder="Enter Page Title">
      <label for="pageDescription">Page Description:</label>
      <input type="text" id="pageDescription" placeholder="Enter Page Description">
      <label for="pageURL">Page URL:</label>
      <input type="text" id="pageURL" placeholder="Enter Page URL">
      <label for="pageImage">Page Image:</label>
      <input type="text" id="pageImage" placeholder="Enter Page Image URL">
      <label for="pageContent">Content:</label>
      <textarea type="text" id="pageContent" placeholder="Enter Page Content"></textarea>
      <br>
      <button id="generateBtn">Generate</button>
      <button id="downloadBtn">Download HTML</button>
      <hr>
      <h2>Generated HTML:</h2>
      <textarea id="output" readonly></textarea>
      <div id="preview"></div>
      <script>
        const generateBtn = document.getElementById('generateBtn');
        const outputTextarea = document.getElementById('output');
        const loadBtn = document.getElementById('loadBtn');
        const fileInput = document.getElementById('fileInput');
        const downloadBtn = document.getElementById('downloadBtn');
        var replacedContent = "";
        
        
        generateBtn.addEventListener('click', generateHTML);
        loadBtn.addEventListener('click', loadExternalHTML);
        downloadBtn.addEventListener('click', downloadGeneratedHTML);
        
        function generateHTML() {
        
        const pageTitle = document.getElementById('pageTitle').value;
        const pageDescription = document.getElementById('pageDescription').value;
        const pageURL = document.getElementById('pageURL').value;
        const pageImage = document.getElementById('pageImage').value;
        const pageContent = document.getElementById('pageContent').value;
        var replacedContent = pageContent.replace(/__([^_]+)__/g, '<h4 id="$1">$1</h4>');
        var replacedContent = replacedContent.replace(/--([^-]+)--/g, '<h3 id="$1">$1</h3>');
        var replacedContent = replacedContent.replace(/==([^=]+)==/g, '<h2 id="$1">$1</h2>');
        var replacedContent = replacedContent.replace(/\{p\}\s*([\s\S]*?)(?=\s*\{p\}|\n\s*|\s*$)/g, '<p>$1</p>\n');
        var replacedContent = replacedContent.replace(/\[\[(.*?)\|(.*?)\|(.*?)\]\]/gs, function(match, p1, p2, p3) {
        var modifiedP1 = p1.replace(/\s/g, '_');
        
        if (!p3 || /^\s*$/.test(p3) || p3 === "null") {
          return '<a href="' + modifiedP1 + '.html" title="' + p2 + '">' + p2 + '</a>';
        } else {
          return '<a href="' + modifiedP1 + '.html" title="' + p2 + '">' + p3 + '</a>';
        }
        });
        var replacedContent = bulletedList(replacedContent);
        var replacedContent = boldAndItalic(replacedContent);
        var replacedContent = InfoboxEpisode(replacedContent);
        var replacedContent1 = generateGalleryModal(replacedContent);
        var replacedContent = templateGallery(replacedContent);
        const pageName = document.getElementById('pageName').value;
        const generatedHTML = `<!DOCTYPE html>
        <html lang="${WikiLanguage}">
        <head>
        <script>
        var pageTitle = "${pageTitle}";
        var pageDescription = "${pageDescription}";
        var pageURL = "${pageURL}";
        var pageImage = "${pageImage}";
        var pageName = "${pageName}";
        var pageContent = \`${pageContent}\`;
        <\/script>
        <script src="js-pack.js"><\/script>
        <script src="variables.js"><\/script>
        <!--Meta tags start here-->
        <!--General-->
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="title" content="${pageTitle}">
        <meta name="description" content="${pageTitle}">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title> ${pageTitle} | ${WikiTitle}<\/title>
        <!--Facebook-->
        <meta property="og:type" content="website">
        <meta property="og:url" content="${pageURL}">
        <meta property="og:title" content="${pageTitle}">
        <meta property="og:description" content="${pageDescription}">
        <meta property="og:image" content="${pageImage}">
        <!--Twitter-->
        <meta property="twitter:card" content="summary_large_image">
        <meta property="twitter:url" content="${pageURL}">
        <meta property="twitter:title" content="${pageTitle}">
        <meta property="twitter:description" content="${pageDescription}">
        <meta property="twitter:image" content="${pageImage}">
        <!--Meta tags end here-->
        <!--Link tags start here-->
        <link rel="shortcut icon" href="favicon.ico">
        <link rel="stylesheet" href="styles/css.css">
        <!--Link tags end here-->
        <\/head>
        <body>
        <script src="js-dropdown-nav.js"><\/script>
        <main>
        <script src="js-header-nav.js"><\/script>
        <div class="wiki-page-title-header">    
          <h1>${pageTitle}</h1>    <hr class="page-separator">    <\/div>
          ${replacedContent}
          ${replacedContent1}
        <\/main>
        <script src="footer.js"><\/script>
        <\/body>
        <\/html>
        `; 
        outputTextarea.value = generatedHTML; } 
        
        
        function loadExternalHTML() {
          const file = fileInput.files[0];
        
          if (file) {
            const reader = new FileReader();
        
            reader.onload = function (event) {
              const externalHTMLContent = event.target.result;
              const scriptRegex = /<script>([\s\S]*?)<\/script>/;
              const matches = scriptRegex.exec(externalHTMLContent);
        
        if (matches && matches.length > 1) {
                const scriptContent = matches[1];
                const tempScript = document.createElement('script');
                tempScript.innerHTML = scriptContent;
                document.body.appendChild(tempScript);
        
                document.getElementById('pageTitle').value = window.pageTitle || null;
                document.getElementById('pageDescription').value = window.pageDescription || null;
                document.getElementById('pageURL').value = window.pageURL || null;
                document.getElementById('pageImage').value = window.pageImage || null;
                document.getElementById('pageContent').value = window.pageContent || null;
                document.getElementById('pageName').value = window.pageName || null;
        
        
                document.body.removeChild(tempScript);
              } else {
                // If no script content found, set inputs to default values (null)
                document.getElementById('pageTitle').value = null;
                document.getElementById('pageDescription').value = null;
                document.getElementById('pageURL').value = null;
                document.getElementById('pageImage').value = null;
                document.getElementById('pageName').value = null;
                document.getElementById('pageContent').value = null;
              }
            };
        
            reader.readAsText(file);
          }
        }
        
        function downloadGeneratedHTML() {
          const pageName = document.getElementById('pageName').value || 'defaultPage';
          const generatedHTML = outputTextarea.value;
          const blob = new Blob([generatedHTML], { type: 'text/html' });
          const url = URL.createObjectURL(blob);
          
          const a = document.createElement('a');
          a.href = url;
          a.download = `${pageName}.html`;
          a.setAttribute('force-download', ''); // This attribute ensures file replacement
          a.click();
        
          // Clean up the URL object
          URL.revokeObjectURL(url);
        }
        
        document.getElementById("generateBtn").addEventListener("click", function() {
              const htmlCode = document.getElementById("output").value;
              const preview = document.getElementById("preview");
              preview.innerHTML = htmlCode;
          });
        
        
          function bulletedList(inputText) {
            const lines = inputText.split('\n');
        let output = '';
        let currentListDepth = 0;
        let isInList = false;
        
        for (const line of lines) {
          const trimmedLine = line.trim();
          if (trimmedLine === '{*}') {
              if (isInList) {
                  output += '</ul>\n';
                  isInList = false;
              }
              output += '<ul>\n';
              currentListDepth = 0;
              isInList = true;
          } else if (trimmedLine === '{**}') {
              if (isInList) {
                  output += '</ul>\n';
                  isInList = false;
              }
          } else if (trimmedLine === '{#}') {
              if (isInList) {
                  output += '</ol>\n';
                  isInList = false;
              }
              output += '<ol>\n';
              currentListDepth = 0;
              isInList = true;
          } else if (trimmedLine === '{##}') {
              if (isInList) {
                  output += '</ol>\n';
                  isInList = false;
              }
          } else {
              if (isInList) {
                  if (trimmedLine.startsWith('{##}')) {
                      const listItem = trimmedLine.substring(4).trim();
                      output += `<li>${listItem}</li>\n`;
                  } else if (trimmedLine.startsWith('{**}')) {
                      output += '<ul>\n';
                      isInList = true;
                  } else {
                      const listItem = trimmedLine.substring(trimmedLine.search(/\S/)).trim();
                      output += `<li>${listItem}</li>\n`;
                  }
              } else {
                  output += `${trimmedLine}\n`;
              }
          }
        }
        
        // Close any remaining open list
        if (isInList) {
          if (currentListDepth === 0) {
              output += '</ul>\n';
          } else {
              output += '</ol>\n';
          }
        }
        
        return output;
        }
        
        
        function boldAndItalic(inputText) {
        let output = inputText.replace(/\{b\}\s*(.*?)\s*\{bb\}/g, '<b>$1</b>');
        output = output.replace(/\{i\}\s*(.*?)\s*\{ii\}/g, '<i>$1</i>');
        return output;
        }
        
        function InfoboxEpisode(text) {
          const regex = /\{episode\}([\s\S]*?)\{\/episode\}/;
          const imageURL = [];

const galleryPattern = /\{gallery\d+\}([\s\S]*?)\{\/gallery\d+\}/g;
const itemPattern = /([^|\r\n]+)(?:\|([^|\r\n]*))?/g;

let match;
while ((match = galleryPattern.exec(text)) !== null) {
  const galleryContent = match[1];
  let itemMatch;
  while ((itemMatch = itemPattern.exec(galleryContent)) !== null) {
    const url = itemMatch[1].trim();
    const alt = itemMatch[2] ? itemMatch[2].trim() : "";
    imageURL.push(url);
  }
}
    
    const generatedText = text.replace(regex, (match, content) => {
        const episodeLines = content.trim().split('\n');
        var [
            episodeTitle, imgSrc, seasonNum, episodeNum,
            nativeTitle, airDate, viewers, writer, director,
            previousEp, nextEp
        ] = episodeLines.map(value => (value === "-" ? "" : value.trim()));
        const infoboxEpisodeSlider = imageURL.indexOf(imgSrc) + 1;
        if (!episodeTitle) episodeTitle = pageTitle;
        if (!previousEp) previousEp = "არ არის";
        if (!nextEp) nextEp = "არ არის";

        return `
            <aside class="infobox-episode">
                <h2 class="infobox-title">${episodeTitle}</h2>
                ${imgSrc ? `<img src="images/resized/800px/${imgSrc}" onclick="openModal();currentSlide(${infoboxEpisodeSlider});scrollthebar()">` : ''}
                <h2 class="infobox-subtitle">ეპიზოდის ინფორმაცია</h2>
                <section>
                    <table>
                        <tbody>
                            <tr>
                                <td>
                                    <a href="Season_${seasonNum}.html" title="სეზონი ${seasonNum}">სეზონი ${seasonNum}</a>
                                </td>
                                <td>ეპიზოდი ${episodeNum}</td>
                            </tr>
                        </tbody>
                    </table>
                    ${nativeTitle ? `
                    <div class="infobox-item">
                        <h3>მშობლიური სახელი:</h3>
                        <div class="infobox-value">"${nativeTitle}"</div>
                    </div>
                    ` : ''}
                    ${airDate ? `
                    <div class="infobox-item">
                        <h3>გამოსვლის თარიღი:</h3>
                        <div class="infobox-value">${airDate}</div>
                    </div>
                    ` : ''}
                    ${viewers ? `
                    <div class="infobox-item">
                        <h3>მაყურებელი:</h3>
                        <div class="infobox-value">${viewers} მლნ</div>
                    </div>
                    ` : ''}
                    ${writer ? `
                    <div class="infobox-item">
                        <h3>სცენარი:</h3>
                        <div class="infobox-value">${writer}</div>
                    </div>
                    ` : ''}
                    ${director ? `
                    <div class="infobox-item">
                        <h3>რეჟისორი:</h3>
                        <div class="infobox-value">${director}</div>
                    </div>
                    ` : ''}
                    <h2 class="infobox-subtitle">
                        <a href="Category-Episodes.html">ეპიზოდების ქრონოლოგია</a>
                    </h2>
                    <table>
                        <thead>
                            <tr>
                                <th>← წინა</th>
                                <th>შემდეგი →</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <i>„${previousEp}“</i>
                                </td>
                                <td>„${nextEp}“</td>
                            </tr>
                        </tbody>
                    </table>
                </section>
            </aside>
        `;
    });
        
        return generatedText;
        }

        function templateGallery(text) {
    const galleryRegex = /\{gallery(\d+)\}([\s\S]*?)\{\/gallery\1\}/g;

    const processedText = text.replace(galleryRegex, (match, galleryNumber, content) => {
        const galleryLines = content.trim().split('\n');
        let output = '<div id="GalleryRow">';
        const startSlideNumber = (galleryNumber === '1') ? 0 : countSlidesBeforeGallery(text, galleryNumber);

        for (let i = 0; i < galleryLines.length; i++) {
            const [imgSrc, imgAlt] = galleryLines[i].split('|').map(value => value.trim());

            if (imgSrc) {
                output += `
                    <div class="GalleryColumn">
                        <img src="images/resized/800px/${imgSrc}" style="width:100%"
                            onclick="openModal();currentSlide(${startSlideNumber + i + 1});scrollthebar()"
                            class="hover-shadow cursor" alt="${imgAlt}">
                    </div>`;
            }
        }

        output += '</div>';
        return output;
    });

    return processedText;
}


// GOOD CODE!!!






// function generateGalleryModal(text) {
// const galleries = text.match(/{gallery\d+}([\s\S]*?){\/gallery\d+}/g);

//   if (!galleries) {
//     return null;
//   }

//   let convertedHTML = `<div id="GalleryModal" style="display: none;">
//     <span class="GalleryClose cursor" onclick="closeModal()" acceskey="esc">✕</span>
//     <div class="modal-content">`;

//   let totalImageCount = 0;

//   galleries.forEach((gallery, index) => {
//     const imagesWithCaptions = gallery.match(/(.+?)\|([^\n]*)/g);

//     if (!imagesWithCaptions) {
//       return;
//     }

//     const galleryNumber = index + 1;
//     const galleryID = `Gallery${galleryNumber}`;
//     const gallerySlideHTML = imagesWithCaptions.map((imgCaption, imgIndex) => {
//       totalImageCount++;
//       const [imageName, caption] = imgCaption.split('|');
//       return `<div class="GallerySlides" style="display: none;">
//         <div class="Gallerynumbertext">${imgIndex + 1}/${imagesWithCaptions.length}</div>
//         <div class="Galleryviewfullimage">
//           <a href="images/${encodeURIComponent(imageName.trim())}" target="_blank">ნახვა</a> |
//           <a href="images/${encodeURIComponent(imageName.trim())}" download="">გადმოწერა</a>
//         </div>
//         <img src="images/resized/800px/${encodeURIComponent(imageName.trim())}">
//       </div>`;
//     }).join('');

//     convertedHTML += gallerySlideHTML;

//     convertedHTML += `
//       <div class="gallery-caption">
//         ${imagesWithCaptions.map((imgCaption, imgIndex) => {
//           const [, caption] = imgCaption.split('|');
//           return caption.trim() ? `<p id="${galleryID}Caption"></p>` : '';
//         }).join('')}
//       </div>
//       <div class="scrollablegallerylist">
//         ${imagesWithCaptions.map((imgCaption, imgIndex) => {
//           totalImageCount++;
//           const [imageName, caption] = imgCaption.split('|');
//           return `<div class="GalleryColumn1" id="galleryitem-${imgIndex + 1}">
//             <img class="${galleryID}Demo cursor" src="images/resized/800px/${encodeURIComponent(imageName.trim())}" style="width:auto"
//               onclick="currentSlide(${imgIndex + 1})" alt="${caption}">
//           </div>`;
//         }).join('')}
//       </div>`;
//   });

//   convertedHTML += `
//     <a class="prev" onclick="plusSlides(-1);scrollthebar()">❮</a>
//     <a class="next" onclick="plusSlides(1);scrollthebar()">❯</a>
//     </div>
//   </div>`;

//   convertedHTML += `<script>
//             function openModal() {
//     document.getElementById("GalleryModal").style.display = "block";
//     var k = document.getElementsByTagName("BODY")[0];
//     k.style.overflow = "hidden";
//   }
//   function closeModal() {
//     document.getElementById("GalleryModal").style.display = "none";
//     var k = document.getElementsByTagName("BODY")[0];
//     k.style.overflow = "visible";
//   }
  
//   var slideIndex = 1;
//   showSlides(slideIndex);
  
//   function plusSlides(n) {
//     showSlides(slideIndex += n);
//   }
  
//   function scrollthebar() {
//     window.location.href = "#galleryitem-" + slideIndex;
//   }
  
//   function currentSlide(n) {
//     showSlides(slideIndex = n);
//   }
  
//   function showSlides(n) {
//     var i;
//     var slides = document.getElementsByClassName("GallerySlides");
//     var dots = document.getElementsByClassName("Gallery1Demo");
//     var Gallery1CaptionText = document.getElementById("Gallery1Caption");
//     if (n > slides.length) {
//       slideIndex = 1
//     }
//     if (n < 1) {
//       slideIndex = slides.length
//     }
//     for (i = 0; i < slides.length; i++) {
//       slides[i].style.display = "none";
//     }
//     for (i = 0; i < dots.length; i++) {
//       dots[i].className = dots[i].className.replace(" active", "");
//     }
//     slides[slideIndex - 1].style.display = "block";
//     dots[slideIndex - 1].className += " active";
//     Gallery1CaptionText.innerHTML = dots[slideIndex - 1].alt;
//   }
//   document.addEventListener('keydown', function(event) {
//     if (event.key === "Escape") {
//       closeModal()
//     }
//   });


//   var startX;
// 	var startY;

// 		// Add touchstart event listener to element
// 		document.getElementById("GalleryModal").addEventListener("touchstart", function(event) {
// 			// Get starting coordinates
// 			startX = event.touches[0].clientX;
// 			startY = event.touches[0].clientY;
// 		});

// 		// Add touchend event listener to element
// 		document.getElementById("GalleryModal").addEventListener("touchend", function(event) {
// 			// Get ending coordinates
// 			var endX = event.changedTouches[0].clientX;
// 			var endY = event.changedTouches[0].clientY;

// 			// Calculate distance and direction
// 			var distanceX = endX - startX;
// 			var distanceY = endY - startY;
// 			var direction;

// 			if (Math.abs(distanceX) > Math.abs(distanceY)) {
// 				direction = (distanceX > 0) ? "right" : "left";
// 			} else {
// 				direction = (distanceY > 0) ? "down" : "up";
// 			}

// 			// Run appropriate function based on direction of swipe
// 			if (direction === "right") {
// 				// Run function for right swipe
// 				plusSlides(-1);
//         scrollthebar();
// 			} else if (direction === "left") {
// 				// Run function for left swipe
// 				plusSlides(1);
//         scrollthebar();
// 			}
// 		});


    
//     // Add keydown event listener to document
// 		document.addEventListener("keydown", function(event) {
// 			// Check if pressed key is left or right arrow
// 			if (event.keyCode === 37) {
// 				// Run function for left arrow press
// 				leftArrowFunction();
// 			} else if (event.keyCode === 39) {
// 				// Run function for right arrow press
// 				rightArrowFunction();
// 			}
// 		});

// 		// Define functions to run on left and right arrow press
// 		function leftArrowFunction() {
// 			plusSlides(-1);
//         scrollthebar();
// 			// Add your code for left arrow press here
// 		}

// 		function rightArrowFunction() {
// 			plusSlides(1);
//         scrollthebar();
// 			// Add your code for right arrow press here
// 		}
//             <\/script>`;

//   return convertedHTML;
//   const generatedGalleryModal = generateGalleryModal(text);
// document.getElementById("galleryModal").innerHTML = generatedGalleryModal;
// }





// GOOD CODE!!!


function generateGalleryModal(text) {
const imageURL = [];
const imageALT = [];
  
  const galleryPattern = /\{gallery\d+\}([\s\S]*?)\{\/gallery\d+\}/g;
  const itemPattern = /([^|\r\n]+)(?:\|([^|\r\n]*))?/g;
  
  let match;
  while ((match = galleryPattern.exec(text)) !== null) {
    const galleryContent = match[1];
    let itemMatch;
    while ((itemMatch = itemPattern.exec(galleryContent)) !== null) {
      const url = itemMatch[1].trim();
      const alt = itemMatch[2] ? itemMatch[2].trim() : "";
      imageURL.push(url);
      imageALT.push(alt);
    }
  }

//   return { imageURL, imageALT };

  let galleryHTML = `
    <div id="GalleryModal" style="display: none;">
      <span class="GalleryClose cursor" onclick="closeModal()" acceskey="esc">✕</span>
      <div class="modal-content">
  `;

  for (let i = 0; i < imageURL.length; i++) {
    galleryHTML += `
      <div class="GallerySlides" style="display: none;">
        <div class="Gallerynumbertext">${i + 1}/${imageURL.length}</div>
        <div class="Galleryviewfullimage">
          <a href="images/${imageURL[i]}" target="_blank">ნახვა</a> |
          <a href="images/${imageURL[i]}" download="">გადმოწერა</a>
        </div>
        <img src="images/resized/800px/${imageURL[i]}">
      </div>
    `;
  }

  galleryHTML += `
    <a class="prev" onclick="plusSlides(-1);scrollthebar()">❮</a>
    <a class="next" onclick="plusSlides(1);scrollthebar()">❯</a>
    <div class="gallery-caption">
  `;

  for (let altText of imageALT) {
    galleryHTML += `
      <p id="Gallery1Caption">${altText}</p>
    `;
  }

  galleryHTML += `
    </div>
    <div class="scrollablegallerylist">
  `;

  for (let i = 0; i < imageURL.length; i++) {
    galleryHTML += `
      <div class="GalleryColumn1" id="galleryitem-${i + 1}">
        <img class="Gallery1Demo cursor" src="images/resized/800px/${imageURL[i]}" style="width:auto" onclick="currentSlide(${i + 1})" alt="${imageALT[i]}">
      </div>
    `;
  }

  galleryHTML += `
      </div>
    </div>
  </div>
  `;

  galleryHTML += `<script>
            function openModal() {
    document.getElementById("GalleryModal").style.display = "block";
    var k = document.getElementsByTagName("BODY")[0];
    k.style.overflow = "hidden";
  }
  function closeModal() {
    document.getElementById("GalleryModal").style.display = "none";
    var k = document.getElementsByTagName("BODY")[0];
    k.style.overflow = "visible";
  }
  
  var slideIndex = 1;
  showSlides(slideIndex);
  
  function plusSlides(n) {
    showSlides(slideIndex += n);
  }
  
  function scrollthebar() {
    window.location.href = "#galleryitem-" + slideIndex;
  }
  
  function currentSlide(n) {
    showSlides(slideIndex = n);
  }
  
  function showSlides(n) {
    var i;
    var slides = document.getElementsByClassName("GallerySlides");
    var dots = document.getElementsByClassName("Gallery1Demo");
    var Gallery1CaptionText = document.getElementById("Gallery1Caption");
    if (n > slides.length) {
      slideIndex = 1
    }
    if (n < 1) {
      slideIndex = slides.length
    }
    for (i = 0; i < slides.length; i++) {
      slides[i].style.display = "none";
    }
    for (i = 0; i < dots.length; i++) {
      dots[i].className = dots[i].className.replace(" active", "");
    }
    slides[slideIndex - 1].style.display = "block";
    dots[slideIndex - 1].className += " active";
    Gallery1CaptionText.innerHTML = dots[slideIndex - 1].alt;
  }
  document.addEventListener('keydown', function(event) {
    if (event.key === "Escape") {
      closeModal()
    }
  });


  var startX;
	var startY;

		// Add touchstart event listener to element
		document.getElementById("GalleryModal").addEventListener("touchstart", function(event) {
			// Get starting coordinates
			startX = event.touches[0].clientX;
			startY = event.touches[0].clientY;
		});

		// Add touchend event listener to element
		document.getElementById("GalleryModal").addEventListener("touchend", function(event) {
			// Get ending coordinates
			var endX = event.changedTouches[0].clientX;
			var endY = event.changedTouches[0].clientY;

			// Calculate distance and direction
			var distanceX = endX - startX;
			var distanceY = endY - startY;
			var direction;

			if (Math.abs(distanceX) > Math.abs(distanceY)) {
				direction = (distanceX > 0) ? "right" : "left";
			} else {
				direction = (distanceY > 0) ? "down" : "up";
			}

			// Run appropriate function based on direction of swipe
			if (direction === "right") {
				// Run function for right swipe
				plusSlides(-1);
        scrollthebar();
			} else if (direction === "left") {
				// Run function for left swipe
				plusSlides(1);
        scrollthebar();
			}
		});


    
    // Add keydown event listener to document
		document.addEventListener("keydown", function(event) {
			// Check if pressed key is left or right arrow
			if (event.keyCode === 37) {
				// Run function for left arrow press
				leftArrowFunction();
			} else if (event.keyCode === 39) {
				// Run function for right arrow press
				rightArrowFunction();
			}
		});

		// Define functions to run on left and right arrow press
		function leftArrowFunction() {
			plusSlides(-1);
        scrollthebar();
			// Add your code for left arrow press here
		}

		function rightArrowFunction() {
			plusSlides(1);
        scrollthebar();
			// Add your code for right arrow press here
		}
            <\/script>`;

  return galleryHTML;
  const generatedGalleryModal = generateGalleryModal(text);
document.getElementById("galleryModal").innerHTML = generatedGalleryModal;
}







function countSlidesBeforeGallery(text, galleryNumber) {
    const regex = /\{gallery(\d+)\}([\s\S]*?)\{\/gallery\1\}/g;
    const modalRegex = /\{modal\}([\s\S]*?)\{\/modal\}/g;
    let count = 0;
    let match;

    while ((match = regex.exec(text)) !== null) {
        const currentGalleryNumber = match[1];
        if (parseInt(currentGalleryNumber) < parseInt(galleryNumber)) {
            const galleryContent = match[2];
            const galleryLines = galleryContent.trim().split('\n');
            count += galleryLines.filter(line => line.split('|')[0].trim() !== '').length;
        } else {
            break;
        }
    }

    return count;
}          
      </script>
    </main>
    <script src="footer.js"></script>
  </body>
</html>